<script>
        document.addEventListener('DOMContentLoaded', () => {
            const zipInput = document.getElementById('zip-input');
            const checkZipBtn = document.getElementById('check-zip-btn');
            const userResult = document.getElementById('user-result');
            
            // Note: This API URL now includes a query parameter
            const API_URL_BASE = '/.netlify/functions/handleZips';

            const handleCheckZip = async () => {
                const queryZip = zipInput.value.trim();
                if (!queryZip) return;

                userResult.innerHTML = `<p class="text-gray-500">Checking...</p>`;
                userResult.className = 'mt-6 text-center p-4 rounded-lg bg-gray-100';

                try {
                    // We now send the zip to the backend to get a specific response
                    const response = await fetch(`${API_URL_BASE}?zip=${queryZip}`);
                    const data = await response.json();

                    if (response.ok) {
                        // Success! We service this area.
                        userResult.innerHTML = `
                            <h3 class="font-bold text-lg text-green-800">Great news! We service ${data.city || 'your area'}.</h3>
                            <p class="text-green-700 mt-1"><strong>Turnaround Time:</strong> ${data.turnaround}</p>
                            <p class="text-green-700"><strong>Trip Charge:</strong> $${parseFloat(data.charge || 0).toFixed(2)}</p>
                        `;
                        userResult.className = 'mt-6 text-center p-4 rounded-lg bg-green-100';
                    } else {
                        // Area not serviced (404) or other error from our function
                        userResult.innerHTML = `
                            <h3 class="font-bold text-lg text-red-800">${data.error}</h3>
                            <p class="text-red-700 mt-1">Please check back later or contact us.</p>
                        `;
                        userResult.className = 'mt-6 text-center p-4 rounded-lg bg-red-100';
                    }
                } catch (error) {
                    // A network error occurred
                    console.error('Fetch error:', error);
                    userResult.innerHTML = `<h3 class="font-bold text-lg text-red-800">Something went wrong. Please try again.</h3>`;
                    userResult.className = 'mt-6 text-center p-4 rounded-lg bg-red-100';
                }
                zipInput.value = '';
            };

            checkZipBtn.addEventListener('click', handleCheckZip);
            zipInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleCheckZip();
            });
        });
    </script>